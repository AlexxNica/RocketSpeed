cpp_library(
    name = 'client',
    headers = AutoHeaders.RECURSIVE_GLOB,
    srcs = [
        'client.cc',
        'options.cc',
        'publisher.cc',
        'shadowed_client.cc',
        'storage/file_storage.cc',
        'topic_subscription_map.cc',
        'multi_shard_subscriber.cc',
        'multi_threaded_subscriber.cc',
        'single_shard_subscriber.cc',
        'resilient_receiver.cc',
        'subscriptions_map.cc',
        'tail_collapsing_subscriber.cc',
    ],
    preprocessor_flags = [
        '-Irocketspeed/github',
        '-DROCKETSPEED_PLATFORM_POSIX=1',
        '-DOS_LINUX=1',
    ],
    deps = [
        '@/rocketspeed/github/src/messages:messages',
        '@/rocketspeed/github/src/port:port',
        '@/rocketspeed/github/src/util:util',
        '@/rocketspeed/github/src/util/common:common',
    ],
    external_deps = [
        'gtest',
        ('sparsehash', None),
    ],
)

cpp_unittest(
    name = 'client_test',
    headers = AutoHeaders.RECURSIVE_GLOB,
    srcs = [
        'tests/client_test.cc',
    ],
    preprocessor_flags = [
        '-Irocketspeed/github',
        '-DROCKETSPEED_PLATFORM_POSIX',
        '-DOS_LINUX',
    ],
    deps = [
        ':client',
        '@/rocketspeed/github/src/messages:messages',
        '@/rocketspeed/github/src/port:port',
        '@/rocketspeed/github/src/util:test',
        '@/rocketspeed/github/src/util:util',
        '@/rocketspeed/github/src/util/common:common',
    ],
    external_deps = [
        'gtest',
    ],
)

cpp_unittest(
    name = 'file_storage_test',
    headers = AutoHeaders.RECURSIVE_GLOB,
    srcs = [
        'storage/tests/file_storage_test.cc',
    ],
    preprocessor_flags = [
        '-Irocketspeed/github',
        '-DROCKETSPEED_PLATFORM_POSIX',
        '-DOS_LINUX',
    ],
    deps = [
        ':client',
        '@/rocketspeed/github/src/port:port',
        '@/rocketspeed/github/src/util:test',
        '@/rocketspeed/github/src/util:util',
        '@/rocketspeed/github/src/util/common:common',
    ],
    external_deps = [
        'gtest',
    ],
)
