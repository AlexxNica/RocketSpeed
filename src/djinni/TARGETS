cpp_library(
    name = 'implementation',
    srcs = [
        'client.cc',
        'conversions.cc',
        'jvm_env.cc',
        'jvm_logger.cc',
        'proxy_wrapper.cc',
    ],
    preprocessor_flags = [
        '-DROCKETSPEED_PLATFORM_POSIX',
        '-DOS_LINUX',
        '-Irocketspeed/github',
        '-Irocketspeed/github/external/djinni/support-lib/jni',
        '-Irocketspeed/github/external/Optional',
    ],
    deps = [
        '@/rocketspeed/github/src/client',
        '@/rocketspeed/github/src/proxy:proxy_library',
        '@/rocketspeed/github/src/util/common:configuration',
        '@/rocketspeed/github/src-gen/djinni:interface',
        '@/rocketspeed/github/external/djinni/support-lib/jni',
    ],
    link_whole = True,
)

cpp_java_extension(
    name = 'rocketspeedjni',
    srcs = [
        'main.cc',
    ],
    preprocessor_flags = [
        '-Irocketspeed/github',
        '-Irocketspeed/github/external/djinni/support-lib/jni',
    ],
    deps = [
        ':implementation',
        '@/rocketspeed/github/src-gen/djinni:jni',
    ],
)

cpp_binary(
    name = 'librocketspeedjni.so',
    srcs = [
        'main.cc',
    ],
    preprocessor_flags = [
        '-Irocketspeed/github',
        '-Irocketspeed/github/external/djinni/support-lib/jni',
    ],
    deps = [
        ':implementation',
        '@/rocketspeed/github/src-gen/djinni:jni',
    ],
    external_deps = [
        ('openjdk', None, 'jvm'),
    ],
    dlopen_enabled = True,
)
